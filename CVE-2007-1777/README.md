# CVE-2007-1777

## Experiment Environment

CentOS 6.5

## INSTALL & Configuration

```
wget https://github.com/mudongliang/source-packages/raw/master/CVE-2007-1777/php-4.4.4.tar.gz
tar -xvf php-4.4.4.tar.gz
cd php-4.4.4
./configure
make
```

## Problems in Installation & Configuration

## How to trigger vulnerability

```
./sapi/cli/php poc.php
```

## PoCs

[MOPB-35-2007:PHP 4 zip_entry_read() Integer Overflow Vulnerability](http://www.php-security.org/MOPB/MOPB-35-2007.html)

[PHP Zip_Entry_Read() Integer Overflow Vulnerability](https://www.securityfocus.com/bid/23169/exploit)

[PHP 4.4.4 - 'Zip_Entry_Read()' Integer Overflow](https://www.exploit-db.com/exploits/29788/)

## Vulnerability Patch

### Root Cause

The `zip_read_entry()` function does not perform any check on the supplied length parameter. Therefore an integer overflow in memory allocation can happen when it adds one byte for a terminating ASCIIZ character.

```
    buf = emalloc(len + 1);
    ret = zzip_read(entry->fp, buf, len);
    buf[ret] = 0;
```

When a length of 0xffffffff is supplied the allocated memory block will be of size 0 while up to 4 GB of data is read from the ZIP archive into this memory block. This will overwrite everything behind the allocated block and can lead to the execution of arbitrary code.

### Stack Trace

### Patch

## References
